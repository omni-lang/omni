// Unit Tests for Array Operations
// This demonstrates comprehensive unit testing for array functionality

import std

// Test basic array operations
func test_basic_array_operations(): int {
    std.test.start("Basic Array Operations")
    
    // Test array creation and initialization
    let numbers: array<int> = [1, 2, 3, 4, 5]
    let length: int = std.array.length(numbers)
    std.assert.eq(length, 5, "Array should have length 5")
    
    // Test array access
    std.assert.eq(numbers[0], 1, "First element should be 1")
    std.assert.eq(numbers[4], 5, "Last element should be 5")
    
    // Test array modification
    numbers[2] = 10
    std.assert.eq(numbers[2], 10, "Modified element should be 10")
    
    // Test array with different types
    let words: array<string> = ["hello", "world", "test"]
    std.assert.eq(std.array.length(words), 3, "String array should have length 3")
    std.assert.eq(words[0], "hello", "First string should be 'hello'")
    
    std.test.end("Basic Array Operations", true)
    return 0
}

// Test array manipulation functions
func test_array_manipulation(): int {
    std.test.start("Array Manipulation Functions")
    
    let original: array<int> = [1, 2, 3]
    
    // Test append function
    let appended: array<int> = std.array.append(original, 4)
    std.assert.eq(std.array.length(appended), 4, "Appended array should have length 4")
    std.assert.eq(appended[3], 4, "Last element should be 4")
    
    // Test prepend function
    let prepended: array<int> = std.array.prepend(original, 0)
    std.assert.eq(std.array.length(prepended), 4, "Prepended array should have length 4")
    std.assert.eq(prepended[0], 0, "First element should be 0")
    
    // Test insert function
    let inserted: array<int> = std.array.insert(original, 1, 10)
    std.assert.eq(std.array.length(inserted), 4, "Inserted array should have length 4")
    std.assert.eq(inserted[1], 10, "Inserted element should be 10")
    
    // Test remove function
    let removed: array<int> = std.array.remove(original, 1)
    std.assert.eq(std.array.length(removed), 2, "Removed array should have length 2")
    std.assert.eq(removed[0], 1, "First element should be 1")
    std.assert.eq(removed[1], 3, "Second element should be 3")
    
    std.test.end("Array Manipulation Functions", true)
    return 0
}

// Test array search and utility functions
func test_array_search(): int {
    std.test.start("Array Search and Utility Functions")
    
    let numbers: array<int> = [5, 2, 8, 1, 9]
    
    // Test contains function
    std.assert.true(std.array.contains(numbers, 5), "Array should contain 5")
    std.assert.false(std.array.contains(numbers, 10), "Array should not contain 10")
    
    // Test index_of function
    let index: int = std.array.index_of(numbers, 8)
    std.assert.eq(index, 2, "Index of 8 should be 2")
    
    // Test reverse function
    let reversed: array<int> = std.array.reverse(numbers)
    std.assert.eq(reversed[0], 9, "First element of reversed array should be 9")
    std.assert.eq(reversed[4], 5, "Last element of reversed array should be 5")
    
    // Test slice function
    let sliced: array<int> = std.array.slice(numbers, 1, 3)
    std.assert.eq(std.array.length(sliced), 2, "Sliced array should have length 2")
    std.assert.eq(sliced[0], 2, "First element of slice should be 2")
    std.assert.eq(sliced[1], 8, "Second element of slice should be 8")
    
    std.test.end("Array Search and Utility Functions", true)
    return 0
}

// Test array concatenation and copying
func test_array_concatenation(): int {
    std.test.start("Array Concatenation and Copying")
    
    let arr1: array<int> = [1, 2, 3]
    let arr2: array<int> = [4, 5, 6]
    
    // Test concat function
    let concatenated: array<int> = std.array.concat(arr1, arr2)
    std.assert.eq(std.array.length(concatenated), 6, "Concatenated array should have length 6")
    std.assert.eq(concatenated[0], 1, "First element should be 1")
    std.assert.eq(concatenated[3], 4, "Fourth element should be 4")
    std.assert.eq(concatenated[5], 6, "Last element should be 6")
    
    // Test copy function
    let source: array<int> = [10, 20, 30]
    let dest: array<int> = [0, 0, 0, 0, 0]
    std.array.copy(source, dest, 3)
    std.assert.eq(dest[0], 10, "Copied first element should be 10")
    std.assert.eq(dest[1], 20, "Copied second element should be 20")
    std.assert.eq(dest[2], 30, "Copied third element should be 30")
    
    std.test.end("Array Concatenation and Copying", true)
    return 0
}

// Test array with different data types
func test_array_types(): int {
    std.test.start("Array with Different Data Types")
    
    // Test integer array
    let int_arr: array<int> = [1, 2, 3, 4, 5]
    std.assert.eq(std.array.length(int_arr), 5, "Integer array should have length 5")
    
    // Test string array
    let str_arr: array<string> = ["hello", "world", "test"]
    std.assert.eq(std.array.length(str_arr), 3, "String array should have length 3")
    std.assert.eq(str_arr[0], "hello", "First string should be 'hello'")
    
    // Test boolean array
    let bool_arr: array<bool> = [true, false, true]
    std.assert.eq(std.array.length(bool_arr), 3, "Boolean array should have length 3")
    std.assert.true(bool_arr[0], "First boolean should be true")
    std.assert.false(bool_arr[1], "Second boolean should be false")
    
    // Test mixed operations on different types
    let appended_str: array<string> = std.array.append(str_arr, "new")
    std.assert.eq(std.array.length(appended_str), 4, "Appended string array should have length 4")
    std.assert.eq(appended_str[3], "new", "Last string should be 'new'")
    
    std.test.end("Array with Different Data Types", true)
    return 0
}

// Test array edge cases
func test_array_edge_cases(): int {
    std.test.start("Array Edge Cases")
    
    // Test empty array
    let empty: array<int> = []
    std.assert.eq(std.array.length(empty), 0, "Empty array should have length 0")
    
    // Test single element array
    let single: array<int> = [42]
    std.assert.eq(std.array.length(single), 1, "Single element array should have length 1")
    std.assert.eq(single[0], 42, "Single element should be 42")
    
    // Test array with duplicate elements
    let duplicates: array<int> = [1, 1, 2, 2, 3]
    std.assert.eq(std.array.length(duplicates), 5, "Array with duplicates should have length 5")
    std.assert.true(std.array.contains(duplicates, 1), "Array should contain 1")
    std.assert.true(std.array.contains(duplicates, 2), "Array should contain 2")
    
    // Test array operations on empty array
    let empty_concat: array<int> = std.array.concat(empty, empty)
    std.assert.eq(std.array.length(empty_concat), 0, "Concatenation of empty arrays should be empty")
    
    std.test.end("Array Edge Cases", true)
    return 0
}

// Test array performance with larger arrays
func test_array_performance(): int {
    std.test.start("Array Performance Tests")
    
    // Test with larger array
    let large_array: array<int> = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    std.assert.eq(std.array.length(large_array), 10, "Large array should have length 10")
    
    // Test operations on large array
    let reversed: array<int> = std.array.reverse(large_array)
    std.assert.eq(reversed[0], 10, "First element of reversed large array should be 10")
    std.assert.eq(reversed[9], 1, "Last element of reversed large array should be 1")
    
    // Test slice operations on large array
    let sliced: array<int> = std.array.slice(large_array, 2, 7)
    std.assert.eq(std.array.length(sliced), 5, "Sliced large array should have length 5")
    std.assert.eq(sliced[0], 3, "First element of slice should be 3")
    
    // Test concatenation of large arrays
    let arr1: array<int> = [1, 2, 3, 4, 5]
    let arr2: array<int> = [6, 7, 8, 9, 10]
    let combined: array<int> = std.array.concat(arr1, arr2)
    std.assert.eq(std.array.length(combined), 10, "Combined large arrays should have length 10")
    
    std.test.end("Array Performance Tests", true)
    return 0
}

// Main function to run all array tests
func main(): int {
    std.io.println("=== Running Array Unit Tests ===")
    
    // Run all test suites
    test_basic_array_operations()
    test_array_manipulation()
    test_array_search()
    test_array_concatenation()
    test_array_types()
    test_array_edge_cases()
    test_array_performance()
    
    // Print test summary
    std.test.summary()
    
    std.io.println("=== Array Unit Tests Complete ===")
    return 0
}
