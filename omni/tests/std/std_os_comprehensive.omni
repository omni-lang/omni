// Comprehensive test for std.os module
import std

func main():int {
    let pid:int = std.os.getpid()
    if pid <= 0 {
        return -1
    }

    let ppid:int = std.os.getppid()
    if ppid < 0 {
        return -2
    }

    let original_cwd:string = std.os.getcwd()
    if std.string.length(original_cwd) == 0 {
        return -3
    }

    let set_ok:bool = std.os.setenv("OMNI_TEST_VAR", "omni-value")
    if !set_ok {
        return -4
    }
    let env_value:string = std.os.getenv("OMNI_TEST_VAR")
    if env_value != "omni-value" {
        return -5
    }
    let unset_ok:bool = std.os.unsetenv("OMNI_TEST_VAR")
    if !unset_ok {
        return -6
    }
    let after_unset:string = std.os.getenv("OMNI_TEST_VAR")
    if after_unset != "" {
        return -7
    }

    let temp_file:string = "std_os_temp.txt"
    let write_ok:bool = std.os.write_file(temp_file, "hello")
    if !write_ok {
        return -8
    }
    let append_ok:bool = std.os.append_file(temp_file, " world")
    if !append_ok {
        std.os.remove(temp_file)
        return -9
    }
    let file_contents:string = std.os.read_file(temp_file)
    if file_contents != "hello world" {
        std.os.remove(temp_file)
        return -10
    }

    if !std.os.exists(temp_file) {
        std.os.remove(temp_file)
        return -11
    }
    if !std.os.is_file(temp_file) {
        std.os.remove(temp_file)
        return -12
    }
    if std.os.is_dir(temp_file) {
        std.os.remove(temp_file)
        return -13
    }

    let copy_path:string = "std_os_temp_copy.txt"
    let copy_ok:bool = std.os.copy(temp_file, copy_path)
    if !copy_ok {
        std.os.remove(temp_file)
        std.os.remove(copy_path)
        return -14
    }
    let copy_contents:string = std.os.read_file(copy_path)
    if copy_contents != file_contents {
        std.os.remove(temp_file)
        std.os.remove(copy_path)
        return -15
    }

    let rename_path:string = "std_os_temp_renamed.txt"
    let rename_ok:bool = std.os.rename(copy_path, rename_path)
    if !rename_ok {
        std.os.remove(temp_file)
        std.os.remove(copy_path)
        std.os.remove(rename_path)
        return -16
    }
    if !std.os.exists(rename_path) {
        std.os.remove(temp_file)
        std.os.remove(rename_path)
        return -17
    }

    let remove_copy:bool = std.os.remove(rename_path)
    if !remove_copy {
        std.os.remove(temp_file)
        std.os.remove(rename_path)
        return -18
    }

    let temp_dir:string = "std_os_tmp_dir"
    let mkdir_ok:bool = std.os.mkdir(temp_dir)
    if !mkdir_ok {
        std.os.remove(temp_file)
        return -19
    }
    if !std.os.is_dir(temp_dir) {
        std.os.remove(temp_file)
        std.os.rmdir(temp_dir)
        return -20
    }

    let chdir_ok:bool = std.os.chdir(temp_dir)
    if !chdir_ok {
        std.os.remove(temp_file)
        std.os.rmdir(temp_dir)
        return -21
    }
    let new_cwd:string = std.os.getcwd()
    if std.string.length(new_cwd) == 0 {
        std.os.chdir(original_cwd)
        std.os.remove(temp_file)
        std.os.rmdir(temp_dir)
        return -22
    }
    // Return to original directory
    let back_ok:bool = std.os.chdir(original_cwd)
    if !back_ok {
        std.os.remove(temp_file)
        std.os.rmdir(temp_dir)
        return -23
    }

    let rmdir_ok:bool = std.os.rmdir(temp_dir)
    if !rmdir_ok {
        std.os.remove(temp_file)
        return -24
    }

    let remove_file_ok:bool = std.os.remove(temp_file)
    if !remove_file_ok {
        return -25
    }

    return 0
}
